#!/bin/sh
#
# This script looks through all the 2, 24 and 48 hour files generated by
# CHASTE TestMeinekeLabellingExperimentsOwenData.hpp
#
# It compiles the output from several different runs, fill in the SETUP 
# section below.

# BEGIN SETUP
results=/local/pmxgm/Simulation_Results
run[0]="2008-02-04-11-40"
run[1]="2008-02-04-11-43"
run[2]="2008-02-04-11-45"
run[3]="2008-02-04-11-55"
run[4]="2008-02-04-11-59"
first_experiment=350
last_experiment=2750
# END OF SETUP

if cd $results; then
	rm -f first_lines.txt
	rm -f middle_lines.txt
	rm -f last_lines.txt
	rm -rf compiled_results
else
	echo "Could not change directory! Aborting." 1>&2
	exit 1
fi

for ((j = 0 ; j<${#run[*]} ; j++))	# Number of program runs
do 
	echo "Compiling results from run $j"
	for (( i=$first_experiment ; i<=$last_experiment ; i=i+48 ))
	do
		2_hour=`expr "$i" "+" 2`
		24_hour=`expr "$i" "+" 24`
		head -1 ${run[$j]}/MeinekeLabellingExperiment/results_from_time_"$2_hour"/vis_results/results.viznodes >> first_lines.txt
		head -1 ${run[$j]}/MeinekeLabellingExperiment/results_from_time_"$24_hour"/vis_results/results.viznodes >> middle_lines.txt		
		tail -1 ${run[$j]}/MeinekeLabellingExperiment/results_from_time_"$24_hour"/vis_results/results.viznodes >> last_lines.txt
	done
	j_plus_one=`expr "$j" "+" 1`
	cp ${run[$j]}/MeinekeLabellingExperiment/results/labelled_t2_totals50_run_"$j_plus_one".dat .
    cp ${run[$j]}/MeinekeLabellingExperiment/results/labelled_t24_totals50_run_"$j_plus_one".dat .
    cp ${run[$j]}/MeinekeLabellingExperiment/results/labelled_t48_totals50_run_"$j_plus_one".dat .
done

mkdir compiled_results
mv labelled_* compiled_results/
mv first_lines.txt compiled_results/
mv middle_lines.txt compiled_results/
mv last_lines.txt compiled_results/
echo "Results compiled and written to directory ${results}/compiled_results"

