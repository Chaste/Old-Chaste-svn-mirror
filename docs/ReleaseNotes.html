<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Chaste Release Notes for version 2.1</title>
  </head>
  <body>

<h1>Chaste Release Notes</h1>

<h2>Release 3.0 (changes since Release 2.3)</h2>

<h3>Headline features</h3>

<h4>General</h4>
<ul>
  <li>The Ubuntu package now also supports Oneiric Ocelot (11.10)</li>
  <li>Support for PETSc 3.1 has been added, and Chaste should also work with the latest versions of the Boost libraries.</li>
  <li>This is the last Chaste release that will officially support Boost 1.33.1 and PETSc 2.2.</li>
  <li>The mechanics (and cardiac electro-mechanics) solvers have been made significantly more flexible.</li>
  <li>It is relatively easy to write new solvers of coupled systems of linear PDEs, and tutorials on how to do this have been added.</li>
  <li>We now recommend using VTK with Chaste, and the default.py hostconfig assumes it is available; previously support for VTK input/output within Chaste defaulted to off.</li>
</ul>

<h4>Cardiac</h4>
<ul>
  <li>(Work has begun on solving fluid flow and electrophysiology with Purkinje fibres, but these features are not yet completed.)</li>
</ul>

<h4>Cell-based</h4>
<ul>
  <li>Lattice based cellular Potts models have been implemented.</li>
  <li>There has been a major refactor of the structure of the cell-based code to make the specification of multi-cell models (such as cell-centre, over-lapping spheres, vertex-based and cellular Potts) more consistent.</li>
  <li>The handling of PDEs has been improved allowing PDEs to be coupled to node-based simulations.</li>
  <li>More exceptions are thrown when incompatible classes are used.  Exception messages give information on how to fix the problem.</li>
</ul>

<h3>Major new functionality &amp; code changes</h3>

<h4>General</h4>
<ul>
  <li>An error is given if using Boost 1.41 due to a <a href="http://sourceforge.net/apps/trac/easystroke/ticket/21">bug</a> in its serialization library.  Versions 1.44-1.46.1 also have a <a href="https://svn.boost.org/trac/boost/ticket/4842">bug</a> triggered when some tests exit, but the tests do run successfully.</li>
  <li>All the solid mechanics related functionality has been moved out of the <tt>pde</tt> component to a new component <tt>continuum_mechanics</tt>. These components should be considered as quite separate to each other.</li>
  <li>The interfaces to the solid mechanics solvers have changed considerably. They now take in a 'problem definition' object and are much more powerful. The tutorials describe the new interfaces in detail.
  <ul>
    <li>The incompressible solver is now called <tt>IncompressibleNonlinearElasticitySolver</tt>.</li>
    <li>Further work has been done on the compressible solver.</li>
    <li>Both the incompressible and compressible solvers take in a new class, <tt>SolidMechanicsProblemDefinition</tt>, on which the material law, body force, displacement and traction boundary conditions are defined. See the solid mechanics tutorial to see how these classes are used. They also now take in a reference to a mesh not a mesh pointer.</li>
    <li>Sliding boundary conditions are now possible (i.e. displacement boundary conditions, for only some components of the displacement, at given nodes).</li>
    <li>Solid mechanics problems can now use boundary conditions that specify that a particular pressure should act in the normal direction on deformed surfaces.  It may not be fully optimised yet though - the Jacobian in the nonlinear solve needs altering.</li>
  </ul></li>
  <li>PDE-related changes:
  <ul>
    <li>When solving general time-dependent PDEs the solution can now be written to file at a specified sampling interval, in a variety of formats (HDF5, cmgui, text).  See <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/UserTutorials/SolvingLinearPdes">UserTutorials/SolvingLinearPdes</a> for more details.</li>
    <li>Renamed <tt>AbstractFeObjectAssembler</tt> to <tt>AbstractFeVolumeIntegralAssembler</tt>, moved the surface integral functionality from this class to <tt>AbstractSurfaceIntegralAssembler</tt>, and created a natural Neumann concrete child of <tt>AbstractSurfaceIntegralAssembler</tt> to be used in PDE solvers.</li>
    <li>These changes allow solvers of <i>systems of PDEs</i> to be set up relatively easily (for PDEs for which it is appropriate to use linear basis functions, e.g. systems of coupled heat or diffusion equations). Tutorials on writing your own PDE solvers have been added: start with <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/UserTutorials/WritingPdeSolvers">UserTutorials/WritingPdeSolvers</a>.</li>
    <li>Added new classes <tt>AbstractLinearParabolicPdeSystemForCoupledOdeSystem</tt> and <tt>LinearParabolicPdeSystemWithCoupledOdeSystemSolver</tt> for the numerical solution of coupled systems of reaction-diffusion PDEs and ODEs.  See the associated tutorial <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/UserTutorials/SolvingLinearParabolicPdeSystemsWithCoupledOdeSystems">UserTutorials/SolvingLinearParabolicPdeSystemsWithCoupledOdeSystems</a>.</li>
    <li>The efficiency of <tt>PetscMatTools::ZeroRowsAndColumnsWithValueOnDiagonal</tt> has been significantly improved, which should improve performance when using Dirichlet boundary conditions.</li>
  </ul></li>
  <li>Due to floating point error, it was previously possible for <tt>TimeStepper</tt> to occasionally take a very small step in long simulations, when all steps should have been the same size, and hence break code that assumed a constant time-step.  The tests and calculations have now been made much more robust, by being based on machine precision rather than magic numbers.
  <ul>
    <li>Any time-stepping object will throw if stepped past its end time.  (Previously (i) the core/heart <tt>TimeStepper</tt> class silently remained at the end time and (ii) the cell_based <tt>SimulationTime</tt> singleton class silently stepped past the end time.)</li>
  </ul></li>
  <li>Mesh-related changes:
  <ul>
    <li><tt>GenericMeshReader</tt> has been changed from a class to a function.  If you use it directly, you must now do something like "<tt>std::auto_ptr&lt;AbstractMeshReader&lt;2,2&gt; &gt; p_reader = GenericMeshReader&lt;2,2&gt;(mesh_path);</tt>".  The returned smart pointer will automatically destroy the reader when it goes out of scope, so any other changes to your code should be limited to replacing <tt>reader</tt> with <tt>*p_reader</tt>.</li>
    <li>Some mixed dimension meshes may now be read in to Chaste, i.e. 1d elements embedded in a 2d or 3d mesh.  The 1d elements are defined in a separate <tt>.cable</tt> file, with the same format as the <tt>.edge</tt> file.</li>
  </ul></li>
  <li>Other new functionality:
  <ul>
    <li>Various additions to <tt>CommandLineArguments</tt> make it possible to pass in lists of arguments for a particular option. An option is now defined as starting with '-' followed by any non-numeric character to avoid confusion with negative numbers. Various helper methods have been added to avoid having to use <tt>char*</tt> and <tt>atoi</tt> etc.</li>
    <li>There's a new class <tt>CompareDoubles</tt> in <tt>MathsCustomFunctions</tt> with static methods for comparing floating point numbers to absolute or relative tolerances.  This is now used in <tt>NumericFileComparison</tt> so that files can be compared to the looser of an absolute or relative tolerance.  The default is still to use just absolute as before.</li>
    <li>Added methods <tt>PetscMatTools::CheckSymmetry</tt> and <tt>PetscMatTools::CheckEquality</tt>.</li>
    <li>Where work can be split between isolated processes, it would be nice to be able to do so easily without worrying about collective calls made inside classes such as <tt>OutputFileHandler</tt> leading to deadlock.  A new method <tt>PetscTools::IsolateProcesses</tt> has been added to facilitate this.  Note that it doesn't guarantee safety - collective calls not resulting from the 3 methods affected will still cause deadlock.</li>
  </ul></li>
</ul>

<h4>Cardiac</h4>
<ul>
  <li>Changes accessible via the XML parameters file:
  <ul>
    <li>Allowed the precision with which Meshalyzer and Cmgui visualisation output is written to be specified from the XML configuration file and via <tt>HeartConfig</tt>. (Thanks to Megan Marsh.)</li>
    <li>Added the ability to specify paths relative to the XML configuration file for elements with type <tt>path_type</tt> (e.g. <tt>ArchiveDirectory</tt> and cell model paths).  Use the attribute <tt>relative_to="this_file"</tt>.</li>
  </ul></li>
  <li>Electro-mechanics: See the cardiac electro-mechanics tutorials for examples/usage of the following changes:
  <ul>
    <li>Cardiac electro-mechanics solvers can now use compressible elasticity as well as incompressible elasticity.</li>
    <li>The interface to <tt>CardiacElectroMechanicsProblem</tt> has completely changed, and the interface to <tt>CardiacElectroMechProblemRegularGeom</tt> has slightly changed. <tt>CardiacElectroMechanicsProblem</tt> now takes in a problem definition object (c.f. the mechanics solvers) which means it is now much more flexible. Anything that can be done in a mechanics simulation can now immediately be done in a electro-mechanics simulation.</li>
    <li>For both <tt>CardiacElectroMechanicsProblem</tt> and <tt>CardiacElectroMechProblemRegularGeom</tt>: electrics PDE timestep if different to 0.01, and simulation end time, should be set using <tt>HeartConfig</tt>, and not in the constructor of the problem class.</li>
    <li><tt>CardiacElectroMechProblemRegularGeom</tt> constructor parameters are in a slightly different order, and it also can't be used with mechano-electric feedback or fibre files any longer (use <tt>CardiacElectroMechanicsProblem</tt> instead).</li>
    <li>Some new tutorial tests have been added.</li>
  </ul></li>
  <li>Added functionality to solve extended bidomain problems (with two cell types at each control volume). This functionality is not yet available for the executable users.</li>
  <li>The ability to perform non-matrix-based assembly (of the RHS vector) has been removed; matrix-based assembly is now always used. The option <tt>SetUseMatrixBasedRhsAssembly</tt> no longer exists.</li>
  <li>The convenience method <tt>GetAllOrtho</tt> used to do VTK visualisation of ortho files was incorrect.  It was returning the <i>rows</i> of the conductivity tensor which represent a transpose of the original fibre data.</li>
  <li>Various cardiac post-processing operations scale poorly with the number of nodes.  This has been significantly improved, although dramatic slowdown will still be observed with very large simulations.  (Technical detail: the reason for this is that the output data is written to the HDF5 file at each printing time-step, and so the file layout is optimised for reading/writing every node at one time-step.  However, post-processing needs to read every time-step for a single node or subset of nodes, and so cannot access disk as efficiently.)</li>
  <li>Implemented calculating fibre orientations (Streeter) in a wedge preparation, for either left or right ventricle.  Previously both LV and RV endocardial surfaces were required.</li>
</ul>

<h4>Cell-based</h4>
<ul>
  <li>A major refactor of the cell population and cell-based simulation class hierarchies has taken place, based upon a distinction between on- and off-lattice models. This was done to integrate the code more thoroughly as on-lattice population and simulation classes were introduced, and to ensure that the use of update rules and forces is more consistent.
  <ul>
    <li>The <tt>CellBasedSimulation</tt> class has been split up into a hierarchy, with <tt>OffLatticeSimulation</tt> and <tt>OnLatticeSimulation</tt> inheriting from  <tt>AbstractCellBasedSimulation</tt>.</li>
    <li>All cell populations now inherit from either <tt>AbstractOffLatticeCellPopulation</tt> or <tt>AbstractOnLatticeCellPopulation</tt> the former are used by <tt>OffLatticeSimulation</tt> and the later are used by <tt>OnLatticeSimulation</tt>.</li>
  </ul></li>
  <li>Cellular Potts models have been implemented in Chaste
  <ul>
    <li>The <tt>PottsBasedCellPopulation</tt> has been created with associated <tt>PottsMesh</tt> and <tt>PottsElement</tt> classes to store spatial information.</li>
    <li>The <tt>AbstractPottsBasedUpdateRule</tt> hierarchy is used to define the dynamics of the simulation.</li>
    <li>Simulations make use of the existing cell-cycle model and cell-killer hierarchies.</li>
    <li>Added functionality for visualizing Potts-based cell simulations either using the visualizer <tt>Visualize2dVertexCells.java</tt> or using Paraview with VTK output.</li>
  </ul></li>
  <li>We have moved much of the cell-based code to use <tt>boost::shared_ptr</tt>s rather than plain pointers. This makes memory handling much more straightforward.
  <ul>
    <li>The <tt>CellBasedSimulation</tt> class and its subclasses now store collections of cell killers, boundary conditions, forces or update rules as <tt>boost::shared_ptr</tt>s.
        These are passed to cell-based simulations as  (e.g.) <tt>std::vector&lt;boost::shared_ptr&lt;AbstractForce&lt;DIM&gt;&gt;&gt;</tt> instead of <tt>std::vector&lt;AbstractForce&lt;DIM&gt;*&gt;</tt>.</li>
    <li>We also use helper macros such as <tt>MAKE_PTR</tt> a lot more in tests; these are defined in the header <tt>SmartPointers.hpp</tt>.</li>
  </ul></li>
  <li>A new overlapping spheres based force law, used by Buske <i>et al.</i> in their 2011 model of the crypt based on previous work by Galle <i>et al.</i>, has been implemented.
  <ul>
    <li>Added <tt>OdeLinearSystemSolver</tt> for solving large systems of ODEs of the form M dr/dt = f(t,r), where M is large and sparse.</li>
    <li>Added two new force classes, <tt>BuskeInteractionForce</tt> and <tt>BuskeCompressionForce</tt>, to implement the model of cell-cell mechanical interactions used by Buske.</li>
    <li>Added the ability to set/get cell radii in <tt>NodeBasedCellPopulation</tt> (via a member of <tt>NodesOnlyMesh</tt>), and allowed these to be updated when cell division/death occurs.  Cell radii may also be written to VTK output.</li>
  </ul></li>
  <li>We have generalised the way that PDEs, coupled to cell-based simulations, are handled:
  <ul>
    <li>Altered the input arguments to the method <tt>CellBasedSimulationWithPdes::UseCoarsePdeMesh</tt> and allowed output of the PDE solution on the coarse mesh.</li>
    <li>Enabled the numerical solution of one or more (steady) reaction-diffusion PDEs coupled to a <tt>NodeBasedCellPopulation</tt>, by introducing a "coarse" PDE mesh associated with the population.</li>
    <li>Extended <tt>CellBasedEventHandler</tt> so that it also records the time spent solving any coupled PDEs, for use in <tt>CellBasedSimulationWithPdes</tt>.</li>
    <li>Created an <tt>AbstractCellBasedPde</tt> class which contains the PDE, the solver, the boundary conditions and an interface to an <tt>AbstractCellPopulation</tt>. This class can be passed to a concrete instantiation of an <tt>AbstractCellBasedSimulation</tt> just as forces or update rules are; this change avoids having to implement PDEs in each of <tt>OffLatticeSimulation</tt> and <tt>OnLatticeSimulation</tt>.</li>
  </ul></li>
  <li>We have introduced a new method of imposing boundary conditions (such as restricted geometries) on cell-based simulations:
  <ul>
    <li>The <tt>CellBasedSimulation</tt> method <tt>ApplyCellPopulationBoundaryConditions</tt> has been removed.</li>
    <li>Boundary conditions must now be implemented using the <tt>CellPopulationBoundaryCondition</tt> hierarchy. This change allows the use of multiple boundary conditions in a cell-based simulation, just as multiple force laws may be used.</li>
  </ul></li>
  <li>An example cell-cycle model class <tt>ContactInhibitionCellCycleModel</tt> has been added. This class may be used to simulate contact inhibition of cell division and assumes that the volume of each cell is stored in the singleton <tt>CellwiseData</tt>.
  <ul>
    <li>The simulation class <tt>VolumeTrackedOffLatticeSimulation</tt> has been created to be used with the contact inhibition cell cycle model.</li>
  </ul></li>
  <li>Cell cycle phases can now be written to file for visualization if required, in the file <tt>results.vizcellphases</tt>.</li>
</ul>

<h3>Minor new functionality and code changes, which may still require changes to user code</h3>

<h4>General</h4>
<ul>
  <li>Mesh-related changes:
  <ul>
    <li>The mesh reader now throws an <tt>Exception</tt> if attributes are declared in the header line but missing in the mesh files.</li>
    <li>Added <tt>AbstractTetrahedralElement::CalculateNormal</tt> and <tt>AbstractTetrahedralMesh::CheckOutwardNormals</tt> to obtain normal vectors to boundary elements, and check they all face outwards, respectively.</li>
    <li>Altered perimeter edges created in <tt>TetrahedralMesh::ConstructRectangularMesh</tt>  and <tt>DistributedTetrahedralMesh::ConstructRectangularMesh</tt> so that they are all oriented anticlockwise.  This makes sure that the normals are pointing outward.</li>
    <li>Previously a <tt>QuadraticMesh</tt> had to read a tetrahedral mesh from file using a special converter (i.e. with the method <tt>ConstructFromLinearMeshReader</tt>). Now the usual method (<tt>ConstructFromMeshReader</tt>) may also be used.  It warns that extra work is done, since a mesher library has to be used to construct the extra nodes.</li>
  </ul></li>
  <li>Build system changes:
  <ul>
    <li>You can now do a coverage build for a single test in a project (e.g. <tt>scons b=Coverage ts=projects/...</tt>).</li>
    <li>We have worked around an SCons issue that causes parallel builds (e.g. <tt>-j3</tt>) with <tt>cl=0</tt> to fail in parallel. However, it uses undocumented internal functionality in SCons, so please report an issue if it fails for you, and tell us what version of SCons you are using.</li>
    <li>Removed broken support for the <tt>SPECIAL_SERIAL</tt> <tt>#define</tt>.  This is unlikely to break anything, since it would have already been broken...</li>
  </ul></li>
  <li>Miscellaneous other changes:
  <ul>
    <li>The <tt>TERMINATE</tt> and <tt>NEVER_REACHED</tt> macros have been moved into <tt>Exception.hpp</tt> (from <tt>PetscTools.hpp</tt>), and various includes tidied up.  Some macros have also been renamed for clarity and readability: <tt>EXPECTNON0</tt> -&gt; <tt>EXPECT_NON0</tt>, <tt>MPIABORTIFNON0</tt> -&gt; <tt>ABORT_IF_NON0</tt>.  (The latter macro now works correctly in non-MPI-using tests.)  Note also, if you are using <tt>PetscTools::Terminate</tt> directly rather than via a macro, that this method no longer exists - use <tt>Exception::Terminate</tt> instead.</li>
    <li>The <tt>EXCEPTION</tt> and <tt>WARNING</tt> macros now allow 'streaming' within their message argument, so that you can write (for example)<pre>EXCEPTION("Number of nodes " &lt;&lt; num_nodes &lt;&lt; " does not match expected value of " &lt;&lt; ELEMENT_DIM+1);</pre></li>
    <li><tt>Exception</tt> subclasses may now change the error message after the base class is constructed.</li>
    <li>A <tt>GetParent</tt> method has been added to <tt>FileFinder</tt>.  A <tt>FileFinder</tt> can also now be created relative to some existing file or directory.</li>
    <li>Functions <tt>CreateEmptyVector</tt> and <tt>IsEmptyVector</tt> have been added to <tt>VectorHelperFunctions.hpp</tt></li>
    <li>Moved the functions <tt>SmallPow</tt> and <tt>Divides</tt> from the <tt>linalg</tt> component into a new header <tt>MathsCustomFunctions.hpp</tt>.</li>
    <li>A new class <tt>AbstractCvodeSystem</tt> has been created between <tt>AbstractCvodeCell</tt> and <tt>AbstractParameterisedSystem</tt>, analogously to <tt>AbstractOdeSystem</tt>.
    <ul>
      <li><tt>AbstractCvodeSystem</tt> has a new method <tt>SetAutoReset</tt>. If this is turned on then CVODE will not have its internal state reset between calls to <tt>Solve</tt> (unless the state variables or simulation time are changed by external code in the meantime).  A method <tt>ResetSolver</tt> has been added to force a reset if other changes are made externally that may require this (e.g. changing the RHS function by modifying a parameter).</li>
    </ul></li>
    <li>Moved all methods of <tt>AbstractParameterisedSystem</tt> which don't require the vector type up into a new base class <tt>AbstractUntemplatedParameterisedSystem</tt>.  This should not affect other code.</li>
    <li>Renamed <tt>PetscMatTools::AssembleFinal</tt> to <tt>PetscMatTools::Finalise</tt>, <tt>PetscMatTools::AssembleIntermediate</tt> to <tt>PetscMatTools::SwitchWriteMode</tt>, and <tt>PetscVecTools::Assemble</tt> to <tt>PetscVecTools::Finalise</tt>.  Similar name changes happened to the analogous <tt>LinearSystem</tt> convenience methods.</li>
    <li>Changed <tt>AbstractLinearEllipticPde::ComputeConstantInUSourceTerm(rX)</tt> to <tt>AbstractLinearEllipticPde::ComputeConstantInUSourceTerm(rX, pElement)</tt> so it can take in an element containing <tt>rX</tt> to make it consistent with <tt>ComputeLinearInUCoeffInSourceTerm</tt>.  You can pass in a <tt>NULL</tt> pointer for <tt>pElement</tt>.  Changed all associated classes.</li>
    <li>Method for writing strain per element added to <tt>AbstractNonlinearElasticitySolver</tt>. There is as yet no interface to it: to use it you must call it from the main output method.</li>
  </ul></li>
</ul>

<h4>Cardiac</h4>
<ul>
  <li>Changes to CellML support:
  <ul>
    <li>The cell model converter class is now more robust to certain errors, and gives more helpful error messages.  Temporary files are now saved when an error occurs during the conversion of a cell model from CellML.</li>
    <li>Various performance improvements have been made to the cell model code generation in PyCml.</li>
    <li>PyCml now includes support for generating cell models that can be solved using the Rush-Larsen method.  These are not available 'by default' but must be generated manually or loaded dynamically.  See <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/browser/trunk/heart/test/ionicmodels/TestRushLarsen.hpp">source:trunk/heart/test/ionicmodels/TestRushLarsen.hpp</a> for some examples.</li>
  </ul></li>
  <li>A binary format has now been defined for fibre files, to enable random access into the file.</li>
</ul>

<h4>Cell-based</h4>
<ul>
  <li>Moved an uncaught exception (from the element Jacobian code) and turned it into a higher-level exception in <tt>MeshBasedCellPopulation</tt>, which is thrown when any element has zero area/volume.</li>
  <li>Added a method to perform vertex intersection swaps in the <tt>VertexMesh</tt> class.</li>
  <li>Resolved bug which prevented VTK or cell volume data at time-step zero being written to file.</li>
  <li>Calling <tt>GetCircularMesh</tt> on a <tt>HoneycombMeshGenerator</tt> that contains ghost nodes now throws an exception; previously the generator created a corrupt mesh.</li>
  <li><tt>HoneycombMeshGenerator</tt> now defaults to not use ghost nodes.</li>
  <li>Moved the method <tt>GetNeighbouringNodeIndices</tt> from <tt>DiscreteSystemForceCalculator</tt> into <tt>AbstractCellPopulation</tt>, where it is pure virtual and hence overridden in subclasses.</li>
  <li>Added an overridden <tt>WriteCellVolumeResultsToFile</tt> method in all cell population subclasses.</li>
  <li>Added the <tt>SerializableSingleton</tt> class to allow for singleton classes and subclasses of <tt>AbstractCellBasedSimulation</tt> to be serialized more easily. This removed the need for the <tt>CryptSimulationArchiver</tt> class, which has been removed: simply use<tt> CellBasedSimulationArchiver</tt> instead.</li>
  <li>Added methods to get the centre of mass and dimensions of a cell population to <tt>CellBasedSimulationWithPdes</tt>.</li>
  <li>Added methods to <tt>NodesOnlyMesh</tt> to allow removal of nodes.</li>
</ul>





<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<hr />
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->





<h2>Release 2.3 (changes since Release 2.2)</h2>
<h3>Headline features</h3>
<h4>General</h4>
<ul>
  <li>Support for the latest version of CVODE (2.6.0)</li>
  <li>Reduced source download size (mainly through a reduction in the amount of data distributed with tests)</li>
</ul>
<h4>Cardiac</h4>
<ul>
  <li>A simple model of drug conductance block is now available in the standalone executable.</li>
  <li>A sequential implementation of adaptive mesh refinement has been added, using a library developed in collaboration with Imperial College London to reduce the computational load and memory footprint of large simulations.  This is not available within the standalone executable however.  Instructions for installing the required library are available on the Chaste wiki at <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/InstallAdaptivityLibrary">InstallAdaptivityLibrary</a>, and you will need to edit your hostconfig file to turn on support in Chaste (by setting <tt>use_adaptivity = True</tt> and adding appropriate paths etc.).</li>
</ul>

<h3>New functionality &amp; major code changes</h3>
<h4>General</h4>
<ul>
  <li>Archiving of ODE systems with parameters has been improved.  You can now add parameters without breaking archive backwards compatibility.</li>
  <li>A mixed-dimension mesh format has been defined and implemented (see the <tt>MixedDimensionMesh</tt> class) as the first step towards incorporating a Purkinje model in Chaste.</li>
  <li>Further improvements to the compressible elasticity solver (although this is still in the process of being implemented).</li>
</ul>
<h4>Cardiac</h4>
<ul>
  <li>Added an optional <tt>ApplyDrug</tt> element to the <tt>Physiological</tt> section of the XML parameters file.  This applies conductance block model to as many channels as required.  Note that conductances to block must be annotated in the CellML file with oxmeta names and as modifiable parameters.  This has been done for the LR91 model as an example.  If a channel is not found in the CellML file, a warning will be generated (once per node...).
  <ul>
    <li><strong>NB</strong> This means that the parameter already in the LR91 model has changed name, which breaks archive backwards compatibility.  Run the <tt>archive_convert.sed</tt> script on your archives to make them usable again.  e.g. "<tt>find . -name *arch.? -print | xargs sed -i -f archive_convert.sed</tt>"</li>
  </ul></li>
  <li>The cardiac post-processing performance has been improved through greater use of caching.</li>
  <li>Alternative material laws for mechanics can now be set from a test (see the tutorials for an example).</li>
</ul>

<h3>Code interface changes, which may require changes to user code</h3>
<h4>General</h4>
<ul>
  <li>The interface of <tt>AbstractCvodeCell</tt> has been changed to be more like <tt>AbstractCardiacCell</tt>.
  <ul>
    <li>Moved <tt>SetStateVariables</tt> to <tt>AbstractParameterisedSystem</tt>. This means that its behaviour for <tt>AbstractCvodeCell</tt> has changed: it just copies the contents now, rather than handing over ownership of the vector. So callers must now delete the vector they pass to this method.
    <ul><li>Hence removed <tt>AbstractCvodeCell::SetStateVariablesUsingACopyOfThisVector</tt> - use <tt>SetStateVariables</tt> instead.</li>
    </ul></li>
    <li>Moved initial conditions methods (<tt>GetInitialConditions</tt>, <tt>SetDefaultInitialConditions</tt>, <tt>SetDefaultInitialCondition</tt>, and <tt>ResetToInitialConditions</tt>) to <tt>AbstractParameterisedSystem</tt>.</li>
    <li>Added helper functions <tt>CreateVectorIfEmpty</tt>, <tt>CopyToStdVector</tt>, and <tt>CopyFromStdVector</tt> to <tt>VectorHelperFunctions.hpp</tt>.</li>
  </ul></li>
  <li>Made <tt>CalculateOnElement</tt> public in <tt>AbstractFunctionalCalculator</tt> so users can compute contributions to integrals on each element.</li>
</ul>
<h4>Cell-based</h4>
<ul>
  <li><tt>NodeBasedCellPopulation</tt> constructors now take in a <tt>NodesOnlyMesh</tt> instead of a vector of nodes.</li>
</ul>




<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<hr />
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->






<h2>Release 2.2 (changes since Release 2.1)</h2>

<h3>Headline features</h3>

<h4>General</h4>

<ul>
  <li>Full default test pack should now pass on more configurations.</li>
  <li>Smarter chunking in HDF5 should reduce the time spent on I/O significantly for simulations with many output time steps.</li>
  <li>Mesh load is scalable in parallel only with our binary mesh format.  A conversion utility is provided.  Please refer to the <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/UserTutorials/CardiacExecutable/MeshConvert">MeshConvert</a> tutorial.</li>
  <li>Performance of checkpointing with large meshes has been improved. We now archive permuted meshes without writing from memory to disc; instead the original files are copied.</li>
  <li>Further improvements to tutorials (including the addition of solid mechanics tutorials), and user documentation.  Executable tutorials (as well as tutorial tests) are now routinely tested automatically.</li>
</ul>

<h4>Cardiac</h4>

<ul>
  <li>Added support for the definition of multiple bath/tissue regions. Based on whichever convention you followed in the elements file, you can inform Chaste of your choice of region identifiers with <tt>HeartConfig::SetTissueIdentifiers(std::set&lt;unsigned&gt; )</tt> and <tt>HeartConfig::SetBathIdentifiers(std::set&lt;unsigned&gt; )</tt>. One can also assign different conductivities to different bath regions with <tt>HeartConfig::SetBathMultipleConductivities(std::map&lt;unsigned, double&gt; )</tt>.</li>
  <li>State variable interpolation may now be used for cardiac simulations.  This can lead to improved conduction velocity accuracy on meshes with spatial resolutions typically used in simulation studies, and has been implemented in an efficient manner. See <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/ChasteGuides/StateVariableInterpolation">ChasteGuides/StateVariableInterpolation</a> for more details.</li>
  <li>It is now possible to output visualisation in parallel VTK (.pvtu) format. To do this you need to set the <tt>parallel_vtk</tt> attribute to "yes" in the <tt>OutputVisualizer</tt> element in the parameters file.</li>
  <li>Fixed bug in fibre direction heterogeneities: when running in parallel some fibre directions were permuted between elements.  (This bug did not exist prior to release 2.1.)</li>
  <li>Fixed bug with conductivity heterogeneities in 1D and 2D causing a '<tt>boost::numeric::ublas::bad_size</tt>' error.</li>
  <li>User may now specify a list of node indices where time traces of output variables are requested (see below for details).</li>
  <li>A (Strang) operator splitting solver has been implemented for monodomain. This is mainly for comparison of numerical methods &mdash; it is neither the default solver nor optimised. It can be switched on using the <tt>HeartConfig</tt> class: <tt>HeartConfig::Instance()-&gt;SetUseDiffusionReactionOperatorSplitting()</tt>.</li>
</ul>

<h4>Cell-based</h4>

<ul>
  <li>A new class <tt>CylindricalHoneycombMeshGenerator</tt> has been created and the existing <tt>HoneycombMeshGenerator</tt> class simplified. This included changing the arguments in the <tt>HoneycombMeshGenerator</tt> constructor. Also the class <tt>HoneycombMutableVertexMeshGenerator</tt> has been merged into <tt>HoneycombVertexMeshGenerator</tt> and the associated method <tt>GetMutableMesh</tt> renamed to <tt>GetMesh</tt> for consistency with the cell-centre code. These changes will break user projects.</li>
  <li>A new cell population boundary condition class hierarchy has been handled, to deal with boundary conditions for cell movement. Such objects are passed to and stored in a <tt>CellBasedSimulation</tt> object in a similar way to forces and cell killers.</li>
  <li>We have extended VTK functionality to allow for point data output from node- and mesh-based cell simulations for visualization in Paraview.</li>
  <li>We have updated user tutorials and added new tutorial on using cell population boundary condition objects.</li>
  <li>It has been made clear what code is needed in concrete <tt>CreateCellCycleModel</tt> methods.</li>
</ul>

<h3>New functionality &amp; major code changes</h3>

<h4">General</h4>

<ul>
  <li>We have a new algorithm for random samples from the normal distribution in the <tt>RandomNumberGenerator</tt>, for increased stability at very large numbers of calls. Any results dependent on this will change, even with the same seed.</li>
  <li>"Infrastructure tests" such as checking copyright notices and for duplicate file names are now not run by default (i.e. <tt>do_inf_tests=0</tt> is now the default setting), unless you have <tt>do_inf_tests=1</tt> in your hostconfig file.</li>
  <li>Some new helper methods have been added to <tt>OutputFileHandler</tt> and <tt>FileFinder</tt>:
    <ul>
      <li><tt>OutputFileHandler::FindFile</tt> - get a <tt>FileFinder</tt> for a file in the output directory</li>
      <li><tt>OutputFileHandler::CopyFileTo</tt> - copy a file to the output directory</li>
      <li><tt>FileFinder::GetLeafName</tt> - get the leaf name of a file</li>
    </ul></li>
  <li>Support has been added for Boost version 1.44. However, note that due to a bug in this Boost version, many tests will crash after they have finished running (with the message "pure virtual method called. terminate called without an active exception")!</li>
  <li>A new header <tt>SmartPointers.hpp</tt> has been added containing a few helpful macros for working with <tt>boost::shared_ptr</tt>.</li>
  <li>Created new helper classes <tt>PetscVecTools</tt> and <tt>PetscMatTools</tt> in <tt>linalg</tt> that encapsulate many of the PETSc functions we use related to vectors and matrices. This isolates much of the PETSc-version-specific code within these classes, enabling cleaner user code. If new PETSc-version-specific code is written, suitable methods should be added to these classes in preference to using PETSc directly.</li>
  <li>Added named attribute functionality to <tt>AbstractParameterisedSystem</tt>, allowing arbitrary real-valued attributes to be attached to ODE classes. This is used by PyCml to support named attributes on CellML models.  Also added <tt>Has...</tt> methods to ODE system information, to avoid the need for <tt>try...catch</tt> statements in generic code.</li>
  <li>Changed the event handler classes to use <tt>MPI_Wtime</tt> rather than <tt>std::clock</tt> as underlying timer. This will give a more accurate wall clock time.</li>
  <li>Time adaptivity can now be implemented for PDE solvers by writing an <tt>AbstractTimeAdaptivityController</tt> subclass. <tt>TestMonodomainWithTimeAdaptivity</tt> does some very simple adaptivity to demonstrate this.</li>
  <li>Reduced parallel overhead associated with assembling PETSc objects. Since Chaste (almost always) ensures that data is generated only on the local process (and the helper methods in <tt>PetscVecTools</tt> and <tt>PetscMatTools</tt> enforce this), no data migration is required. We therefore by default set the PETSc option not to check whether migration is needed (<tt>{VEC,MAT}_IGNORE_OFF_PROC_ENTRIES</tt>).</li>
  <li>ODE solvers now inherit from <tt>Identifiable</tt> in order to provide reflection, so that the solver used can be written to results files by <tt>OdeSolution</tt>. Unfortunately, this means that on older Boost versions (&lt;1.37) you need to include <tt>CheckpointArchiveTypes.hpp</tt> in any test which solves an ODE system to obtain an <tt>OdeSolution</tt> object, or you'll experience a segfault!</li>
</ul>

<h4>Cardiac</h4>

<ul>
  <li>New options in the XML parameters file:
    <ul>
      <li>A user may now specify a list of node indices where time traces of output variables are requested.  See <tt>ChasteParametersFullFormat.xml</tt> for an example of usage and the documentation of <tt>PostProcessingWriter::WriteVariablesOverTimeAtNodes</tt> for further information. The output files (one file per output variable) will have the nodal time traces arranged in columns (gnuplot-friendly), one column per requested node. The node numbers that the user requests are referred to the original (unpermuted) node numbering (hence it may differ from what the user sees - for example - when visualizing the output of a previous parallel simulation). No matter what permutation is used in the simulation, the output of the requested nodes will be the same.</li>
      <li>A new post-processing step to calculate pseudo-ECGs has been added to the Chaste parameters file: the <tt>PseudoEcgElectrodePosition</tt> element, which specifies where the virtual probe electrode should be placed. This element may occur multiple times to calculate ECGs from different probe locations. Note that probe electrodes must be located outside the heart tissue!</li>
      <li>A <tt>MeshPartitioning</tt> element has been added in the <tt>Numerical</tt> parameters section, allowing you to specify how a mesh gets partitioned in parallel (dumb/metis/parmetis/petsc). This maps to the <tt>HeartConfig</tt> methods <tt>Set/GetMeshPartitioning</tt>.</li>
      <li>Stimuli section can use ellipsoid regions.</li>
    </ul></li>
  <li>Explicit instantiation is now used for <tt>CardiacSimulationArchiver</tt>, allowing this class and <tt>CardiacSimulation</tt> to be split into <tt>.hpp</tt> and <tt>.cpp</tt> files. This improves compile times (especially for the Intel compiler) but may break some projects or tests which use checkpointing when run with older Boost versions (&lt;1.37).</li>
  <li>Various improvements to cell model generation from CellML:
    <ul>
      <li>Lookup table settings (table bounds and step size) can now be modified at run-time, not just code generation time. There is a new <tt>AbstractLookupTableCollection</tt> base class for lookup tables that provides this functionality, with a get method on <tt>AbstractCardiacCellInterface</tt> that is overridden by subclasses providing tables.</li>
      <li>There have been some improvements to the performance of various cell model optimisations. Some are not yet enabled by default (PyCml flags <tt>--include-dt-in-tables</tt>, <tt>--combine-commutative-tables</tt>, <tt>--no-member-vars</tt>, <tt>--pe-convert-power</tt>) and others are "unsafe in general" (PyCml flag <tt>--no-check-lt-bounds</tt>).</li>
      <li>Conversion issues between cardiac cell models and Chaste are now handled in a more generic fashion within PyCml by creating an interface component. This ensures that all quantities read or written by the Chaste tissue model, including ionic currents, are in the correct units.</li>
      <li>There is now a constructor options which allows the cell model converter (<tt>CellMLToSharedLibraryConverter</tt>) to save generated C++ source files for inspection.</li>
      <li>A new option <tt>--expose-annotated-variables</tt> has been added to PyCml, which exposes all oxmeta-annotated variables to the <tt>GetAnyVariable</tt> functionality, i.e. it annotates non-state variables as parameters or derived quantities, as appropriate.  There is also an <tt>--expose-all-variables</tt> option, which annotates every variable in the model.</li>
      <li>Allowed certain computed variables (those which can be determined not to vary at run-time) to be metadata annotated constants. In particular, this allows the default stimulus current amplitude to be calculated within the cell model, rather than given as a fixed constant number.</li>
      <li>Used the new named attribute functionality on <tt>AbstractParameterisedSystem</tt> to support named attributes on CellML models.</li>
    </ul></li>
  <li>Dedicated S1-S2 and dynamic restitution stimuli classes (mainly for single cell work) have been brought into the main trunk from a user project.</li>
  <li>Added <tt>Has...</tt> methods to cardiac modifiers, to avoid the need for <tt>try...catch</tt> statements in generic code.</li>
  <li>Implemented <tt>SolveAndUpdateState</tt> for backward Euler cells.</li>
  <li>The interface for <tt>CardiacElectroMechanicsProblem</tt> (and <tt>CardiacElectroMechProbRegularGeom</tt>) has changed slightly, instead of taking in the number of electrics solves per mechanics solve, it takes in the mechanics solve timestep (which should be a multiple of the electrics PDE solve).</li>
</ul>

<h4>Cell-based</h4>

<ul>
  <li>See above under "Headline features".</li>
</ul>

<h3>Code interface changes that may require changes to user code</h3>

<h4>General</h4>

<ul>
  <li>The interface to the <tt>SimpleLinearParabolicSolver</tt> has changed: instead of calling <tt>SetTimes(t0,t1,dt)</tt>, you have to call two methods <tt>SetTimes(t0,t1)</tt> and <tt>SetTimeStep(dt)</tt>.</li>
  <li><tt>DistributedVectorFactory</tt> now always sets <tt>mpOriginalFactory</tt> when loaded from an archive.</li>
  <li>Moved the partitioning type into its own header file, rather than being nested in <tt>DistributedTetrahedralMesh</tt>. You just need to change (e.g.) <tt>DistributedTetrahedralMesh&lt;1,1&gt;::DUMB</tt> to <tt>DistributedTetrahedralMeshPartitionType::DUMB</tt>.</li>
</ul>

<h4>Cardiac</h4>

<ul>
  <li><tt>VerifyStateVariables</tt> is now not called in <tt>NDEBUG</tt> builds, which may lead to tests not 'failing' in optimised builds.</li>
  <li>Added an optional parameter <tt>pStateVariables</tt> to <tt>GetIIonic</tt>, which gives the state at which to evaluate the current. This will require a change to any manually written cell model to match the new interface.</li>
</ul>

<h4>Cell-based</h4>

<ul>
  <li>Every cell cycle model now needs an <tt>OutputCellCycleModelParameters</tt> method.  See existing models for what it should include.</li>
</ul>





<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<hr />
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->





<h2>Release 2.1 (changes since Release 2.0)</h2>

<h3>Headline changes</h3>

<h4>General</h4>

<ul>
  <li>
    The user documentation has been significantly extended, and tutorials written for the cardiac executable.  Static versions of user guides and tutorials are available
    for this release <a href="https://chaste.cs.ox.ac.uk/chaste/tutorials/release_2.1/">here</a>.
  </li>
  <li>
    External calls to the TetGen binary for <tt>MutableMesh::ReMesh()</tt> and for constructing instances of <tt>QuadraticMesh</tt> have been replaced by library calls.
    There is thus no longer a need to install TetGen, and the TetGen source version 1.4.2 is now included with the release.
    These changes will affect the results of 3D cell based simulations (slightly).
  </li>
</ul>

<h4>Cardiac</h4>

<ul>
  <li> 
    The standalone binary now has a folder of dependency libraries and a wrapper script <tt>Chaste.sh</tt> which ensures that these libraries are linked when the program is run.  The binary used to be a single monolithic file with all the dependencies compiled into it but this was known to cause run-time problems for some Linux distributions. </li>
  <li>
    The integration of CellML models of cardiac cells has been significantly improved.  Code for all cell models shipped with Chaste is now generated on-the-fly from CellML,
    leading to some naming changes which will affect users of the source distribution (see below for details).  The process is highly configurable; see our
    <a href="https://chaste.cs.ox.ac.uk/chaste/tutorials/release_2.1/ChasteGuides/CodeGenerationFromCellML.html">guide page</a> for details.  In particular, variables
    within the model may be annotated as modifiable parameters or derived quantities, and are then made available for access by name, both in the source release and via the
    executable.
    There is also improved support for units conversions, so that models can use any convention for the ionic currents and stimulus.
  </li>
  <li>
    Various simulation parameters can now be changed via the XML file when resuming from a checkpoint.  These include cell model parameters, stimuli definitions, numerical
    parameters, and post-processing specifications.
  </li>
  <li>
    Cardiac PDE classes (which no longer contain PDE information) have now been renamed to be tissues, e.g. <tt>BidomainPde</tt> is now <tt>BidomainTissue</tt>.
    This change means that <b>archives that used to contain such a class must also change, and so are not backwards compatible</b> (an &quot;unregistered class&quot; error will
    be generated).  A script <tt>archive_convert.sed</tt> is provided in both the source and executable releases of Chaste to migrate archives to the new naming.
    You can run it as follows:
<pre>
    sed -i -f archive_convert.sed path_to_checkpoint_data_folder/*.arch*
</pre>
  </li>
</ul>

<h3>Library compatibility</h3>
<ul>
  <li>PyCml can now use <a href="http://www.rdflib.net/">RDFLib</a> as the RDF library, which is a lot easier to install than the Redland library.</li>
  <li>Chaste should now work with Boost versions 1.41 and above, although it does not yet receive as thorough testing on these.</li>
</ul>

<h3>Code changes</h3>

<h4>New functionality and major changes</h4>
<ul>
  <li>General:<ul>
    <li>
      A new <tt>Warnings</tt> class has been introduced to keep track of issues that don't prevent the simulation completing but may need investigation to verify the results.
      All unexpected warnings are printed at the end of the simulation or test-suite. If logging is switched on, then warnings appear in the log file as they happen.
    </li>
    <li>
      The finite element assembler hierarchy has been completely changed and replaced with new assemblers and new solvers.
      See <a href="https://chaste.cs.ox.ac.uk/chaste/tutorials/release_2.1/ChasteGuides/FiniteElementAssemblersAndSolvers.html">ChasteGuides/FiniteElementAssemblersAndSolvers</a> for details.
    </li>
    <li>
      Some SCons synonyms for common developer options have been provided (e.g. <tt>scons cl=1 b=_2 up=0 ts=mesh/test/TestDistributedTetrahedralMesh.hpp</tt>).
      See the <a href="https://chaste.cs.ox.ac.uk/chaste/tutorials/release_2.1/ChasteGuides/UserBuildGuide.html">build guide</a> for details.
    </li>
    <li>
      The <tt>DistanceMapCalculator</tt> calculates in-mesh path distances along mesh edges rather than Euclidean distances.  The underlying algorithm is Dijkstra/A*
      which produces partition-dependent solutions to the Euclidean distance problem but reliable solutions to the edge-based distance problem.
    </li>
    <li>
      There have been several changes to the ODE system hierarchy, primarily related to providing information about the ODE system.  As well as information about state variables,
      we now support named parameters and derived quantities.
      <ul>
        <li>A new base class <tt>AbstractParameterisedSystem</tt> has been created for <tt>AbstractOdeSystem</tt> and <tt>AbstractCvodeCell</tt> to contain the system information state and methods.</li>
        <li>Renamed various methods on <tt>AbstractOdeSystem</tt> (now moved to <tt>AbstractParameterisedSystem</tt>) and <tt>AbstractOdeSystemInformation</tt> for clarity and consistency:
          <ul>
            <li><tt>rGetVariableNames/Units -> rGetStateVariableNames/Units</tt></li>
            <li><tt>SetInitialConditionsComponent -> SetInitialCondition</tt></li>
            <li><tt>GetStateVariableNumberByName -> GetStateVariableIndex</tt></li>
            <li><tt>GetStateVariableValueByNumber -> GetStateVariable</tt></li>
            <li><tt>GetStateVariableUnitsByNumber -> GetStateVariableUnits</tt></li>
          </ul>
        </li>
        <li>
          For named parameters, added methods <tt>GetParameterIndex</tt>, <tt>GetParameterUnits</tt>, <tt>rGetParameterNames</tt>, and <tt>rGetParameterUnits</tt> on <tt>AbstractParameterisedSystem</tt>
          and <tt>AbstractOdeSystemInformation</tt>, and also methods <tt>Get/SetParameter</tt> and <tt>GetNumberOfParameters</tt> on <tt>AbstractParameterisedSystem</tt>.
        </li>
        <li>
          For derived quantities, added methods <tt>GetDerivedQuantityIndex</tt>, <tt>GetDerivedQuantityUnits</tt>, <tt>rGetDerivedQuantityNames</tt>, and <tt>rGetDerivedQuantityUnits</tt>
          on <tt>AbstractParameterisedSystem</tt> and <tt>AbstractOdeSystemInformation</tt>.  <tt>AbstractParameterisedSystem</tt> also has <tt>GetNumberOfDerivedQuantities</tt>,
          <tt>ComputeDerivedQuantities</tt>, and <tt>ComputeDerivedQuantitiesFromCurrentState</tt>.  Note that these latter methods require the current time as input (in case the derived 
          quantity was function of time) and may not be very efficient.  Concrete ODE system classes should define <tt>ComputeDerivedQuantities</tt> if they provide any derived quantities. 
          The <tt>OdeSolution</tt> class also has support for writing derived quantities to disk.
        </li>
        <li>
          Finally, there is also "any variable" functionality, with similarly named methods (e.g. <tt>GetAnyVariableIndex</tt>) which try first state variables, then parameters,
          then derived quantities, until a matching name is found.  To support derived quantities, <tt>GetAnyVariable</tt> can optionally take the current time as a second parameter
          (it defaults to zero).
        </li>
      </ul>
    </li>
    <li>
      A new class <tt>FileFinder</tt> has been created to specify file locations (particularly for input) throughout the code (and in the XML cardiac parameters file) allowing for
      greater flexibility.  Various locations that used to use plain strings now use this class instead, which may require small changes to code using these.
    </li>
    <li>In order to compare files with provenance data <tt>NumericFileComparison</tt> now ignores lines which begin with "# ".</li>
  </ul>
  </li>
  <li>Cardiac:<ul>
    <li>Numerical and post-processing parameters can now be changed when resuming a simulation from a checkpoint. See <a href="https://chaste.cs.ox.ac.uk/chaste/tutorials/release_2.1/UserTutorials/CardiacExecutable/CheckpointingAndRestarting.html">UserTutorials/CardiacExecutable/CheckpointingAndRestarting</a> for details.</li>
    <li>
      The <tt>OutputVariables</tt> functionality has been fixed to actually output the variables requested!  It can now output any state variable, or any variable annotated
      as a parameter or derived quantity in the cell model.
    </li>
    <li>
      The use of multiple lookup tables should now work.  The LuoRudy1991 model uses both <i>V</i> and <i>Ca_i</i> as table keys as an example.  This leads to slight changes to
      results when using an optimised LR91 model.
    </li>
    <li>
      Backward Euler cell models are now also optimised using partial evaluation and lookup tables, and the latter optimisations have also been improved.
      This has lead to slight changes in results when using optimised models.
    </li>
    <li>
      APD calculation has changed so that it detects the resting potential, and therefore upstroke, more accurately. APDs will change slightly when run with the new version of the code.
    </li>
    <li>
      A new class <tt>AbstractCardiacCellInterface</tt> has been introduced as a common parent of <tt>AbstractCardiacCell</tt> and <tt>AbstractCvodeCell</tt>.
      This shouldn't have any impact on existing code, but will make it easier to switch between the two.
    </li
    <li>The deprecated <tt>ScaleFactor*</tt> elements are now optional in the XML schema.  Use of <tt>SetParameter</tt> is preferred.</li>
    <li>
      The <tt>DistanceMapCalculator</tt> calculates in-mesh path distances along mesh edges rather than Euclidean distances.  The underlying algorithm is Dijkstra/A*
      which produces partition-dependent solutions to the Euclidean distance problem but reliable solutions to the edge-based distance problem.  This change affects:
      <ul>
        <li>Calculation of conduction velocities - distances might now be overestimated, but will preserve detours around cavities.</li>
        <li>Calculation of transmural Epi/Mid/Endo layers - relative position in wall may vary from previous.</li>
        <li>Algorithmic generation of fibre directions (Streeter method) - relative position in wall may vary from previous.</li>
      </ul>
    </li>
  </ul>
  </li>
  <li>Cell-based:<ul>
    <li>
      If writing cell mutation states to the file <tt>cellmutationstates.dat</tt> in a <tt>TissueSimulation</tt>, the name of each mutation state present is now taken from its extended type ID info 
      using a new method <tt>Identifiable::GetIdentifier</tt>.
    </li>
    <li>
      Work is in progress on restructuring how model parameters are accessed in the cell-based code.
      As part of this, all of the <tt>TissueConfig</tt> members have been moved into the classes in which they are used.
      Simulations will now output a file containing the parameters used for that simulation.
      In order to implement this:<ul>
        <li>All <tt>CellKiller</tt> classes now require a <tt>OutputCellKillerParameters</tt> method.</li>
		<li>All tissue classes now require a <tt>OutputTissueParameters</tt> method.</li>
		<li>All force classes now require a <tt>OutputForceParameters</tt> method.</li>
		<li>All such classes (and simulation subclasses) must have an archiving export key defined correctly.</li>
      </ul>
      See the tutorials for more information on how to write these.
    </li>
    <li>
      The principles behind the cell mutation state refactor have now been applied more generally to cell properties, enabling the creation of arbitrary properties
      that can be attached to cells.  There are new classes <tt>AbstractCellProperty</tt> and <tt>CellPropertyCollection</tt>, and <tt>CellMutationStateRegistry</tt>
      has been replaced by <tt>CellPropertyRegistry</tt>.  A <tt>TissueCell</tt> now has a <tt>CellPropertyCollection</tt> member, in which it stores its mutation state
      as well as any other cell property the user chooses.  Cell properties can be passed into the <tt>TissueCell</tt> constructor or by using the new method
      <tt>AddCellProperty</tt>.  Similarly there are new methods <tt>RemoveCellProperty</tt> and <tt>rGetCellPropertyCollection</tt> on <tt>TissueCell</tt>.  Also,
      <ul>
        <li>The mutation state <tt>LabelledCellMutationState</tt> has been replaced with a new cell property class <tt>CellLabel</tt>.</li>
        <li><tt>APOPTOTIC</tt> is no longer a <tt>CellProliferativeType</tt> but has been replaced with a new class <tt>ApoptoticCellProperty</tt>.</li>
        <li>The output of some <tt>Tissue</tt> methods, such as <tt>GetCellMutationStateCount</tt>, have been changed.</li>
        <li>
          The classes <tt>Alarcon2004OxygenBasedCellCycleOdeSystem</tt> and <tt>Alarcon2004OxygenBasedCellCycleModel</tt> have been modified, so that instead of storing
          a cell's mutation state, now they just store whether it has the cell property <tt>CellLabel</tt>.
        </li>
        <li>Removed unused <tt>Alarcon2004OxygenBasedCellCycleModel</tt> member variable <tt>mIsLabelled</tt>.</li>
      </ul>
    </li>
    <li>
      The creation of ODE-based cell cycle models has been eased.  There is now a wrapper around ODE solvers, <tt>AbstractCellCycleModelOdeSolver</tt> (with concrete singleton
      implementation <tt>CellCycleModelOdeSolver</tt>) and ODE-based cell cycle model constructors now take an optional <tt>shared_ptr&lt;AbstractCellCycleModelOdeSolver></tt>
      allowing the user to specify what solver to use.  A mixin base class for cell cycle models, <tt>CellCycleModelOdeHandler</tt>, has been created which cell cycle models
      that solve a system of ODEs to determine progress through the cell cycle can inherit from.
    </li>
  </ul>
  </li>
</ul>

<h4>Interface changes that may require changes to user code</h4>
<ul>
  <li>General:<ul>
    <li>In <tt>AbstractLinearParabolicPde</tt>, <tt>ComputeLinearSourceTerm(x)</tt> and <tt>ComputeNonlinearSourceTerm(x,u)</tt> have been merged into one method <tt>ComputeSourceTerm(x,u)</tt>.</li>
    <li>
      The macro <tt>NEVER_REACHED</tt> has become a termination error and will always terminate (sequential/parallel and debug/NDEBUG).  This is a level 4 error according to our
      <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/ExceptionStrategy">exception strategy</a>.  <tt>NEVER_REACHED</tt> now relies on <tt>PetscTools</tt> (so that it
      can either exit or abort in parallel) -- compilation may fail if you are missing <tt>#include "PetscTools.hpp"</tt>.
    </li>
    <li>
      Providing an estimate of the maximum number of nonzero entries expected on any row is now compulsory and is done via an additional argument to <tt>PetscTools::SetupMat</tt>,
      rather than by a call to <tt>PetscTools::SetMaxNumNonzerosIfMatMpiAij</tt>.  <tt>PetscTools::SetupMat</tt> no longer has a <tt>MatType</tt> argument.  Code that uses the old
      method in the problem class will no longer compile or may interpret extra arguments incorrectly.  Instead, changes must be made to the <tt>InitializeForSolve</tt> method of the
      assembler.  Instead of instantiating the linear system by <tt>this->mpLinearSystem = new LinearSystem(template_vec);</tt>, we must add an extra argument:
      <tt>this->mpLinearSystem = new LinearSystem(template_vec, *NNZ*);</tt>.
    </li>
    <li>
      Replaced all mesh functionality for getting extremes of meshes with <tt>AbstractMesh::CalculateBoundingBox</tt> returning a <tt>ChasteCuboid</tt>.  The parallel specialisation in
      <tt>DistributedTetrahedralMesh</tt> gets the bounding box of the global mesh.
    </li>     
    <li>Renamed various methods on <tt>AbstractOdeSystem</tt> and <tt>AbstractOdeSystemInformation</tt> for clarity.  We want to stress that these methods do not change
        the state variables of the instance of an ODE on which they are called, but the values considered default.
      <ul>
        <li> <tt>SetInitialConditions</tt> -> <tt>SetDefaultInitialConditions</tt> </li>
        <li> <tt>SetInitialCondition</tt> -> <tt>SetDefaultInitialCondition</tt> </li>
      </ul> 
    </li>
    <li>
      <tt>PetscTools::CreateVec(int size, double value)</tt> method renamed to <tt>CreateAndSetVec</tt>.  The removal of this overload allows for the new interface method
      <tt>PetscTools::CreateVec(int size, int localSize)</tt>.
    </li>
    <li>Distributed mesh <tt>GetAnyNode</tt> method renamed to <tt>GetNodeOrHaloNode</tt>.</li>
  </ul>
  </li>
  <li>Cardiac:<ul>
    <li>
      All cell models are generated on the fly from CellML, which will break code previously using these. Please update the following:
      <ul>
        <li><tt>#include</tt> directives:
          <ul>
            <li><tt>luo_rudy_1991.hpp -> LuoRudy1991.hpp, luo_rudy_1991Opt.hpp -> LuoRudy1991Opt.hpp, luo_rudy_1991BackwardEuler.hpp and BackwardEulerLuoRudyIModel1991.hpp -> LuoRudy1991BackwardEuler.hpp, luo_rudy_1991Cvode.hpp -> LuoRudy1991Cvode.hpp, luo_rudy_1991CvodeOpt.hpp -> LuoRudy1991CvodeOpt.hpp</tt></li>
            <li><tt>noble_varghese_kohl_noble_1998_a.hpp -> NobleVargheseKohlNoble1998a.hpp, noble_varghese_kohl_noble_1998_aOpt.hpp -> NobleVargheseKohlNoble1998aOpt.hpp</tt></li>
            <li><tt>tentusscher_model_2006_epi_corrected_flooristim.hpp -> TenTusscher2006Epi.hpp, tentusscher_model_2006_epi_corrected_flooristimOpt.hpp -> TenTusscher2006EpiOpt.hpp, tentusscher_model_2006_epi_corrected_flooristimBackwardEuler.hpp and BackwardEulerTenTusscher2006.hpp -> TenTusscher2006EpiBackwardEuler.hpp</tt></li>
          </ul></li>
        <li>Class names: New names all take the form "<tt>Cell&lt;FileBaseName>FromCellML&lt;Modifiers></tt>", e.g. <tt>CellLuoRudy1991FromCellML</tt>,
            <tt>CellTenTusscher2006EpiFromCellMLOpt</tt>, <tt>CellLuoRudy1991FromCellMLCvodeOpt</tt>, <tt>CellTenTusscher2006EpiFromCellMLBackwardEuler</tt>.</li>
      </ul>
      See the <a href="https://chaste.cs.ox.ac.uk/chaste/tutorials/release_2.1/ChasteGuides/CodeGenerationFromCellML.html">guide page</a> for more details.
    </li>
    <li><tt>#include "Maleckar2009OdeSystem.hpp"</tt> should be replaced with <tt>#include "Maleckar2008.hpp"</tt> to reflect year of publication.</li>
  </ul>
  </li>
  <li>Cell-based:<ul>
    <li>
      To reflect the general nature of the classes, we have renamed <tt>TissueCell</tt> to <tt>Cell</tt>, <tt>Tissue</tt> to <tt>CellPopulation</tt> and
      <tt>TissueSimulation</tt> to <tt>CellBasedSimulation</tt>.
    </li>
    <li>
      We now create and access <tt>Cell</tt> objects via Boost shared pointers, and disallow copying of <tt>Cell</tt>s, since this doesn't make biological sense and is inefficient.
      The type alias <tt>CellPtr</tt> is available to ease transition and save typing!  Many methods that previously took in or returned <tt>Cell</tt>s now deal
      with <tt>CellPtr</tt>s.  Copying of cell cycle models has also been disallowed.
    </li>
    <li><tt>CellBasedSimulation</tt> and inherited classes now do not take in a force collection. To set the mechanics system call the <tt>AddForce</tt> method.</li>
    <li>
      The mesh classes <tt>Face</tt>, <tt>VoronoiCell</tt>, <tt>VoronoiTessellation</tt> and <tt>InventorVoronoiWriter</tt> have been deleted.  This is because they are no longer
      used in the code.  Now, when a <tt>MeshBasedTissue</tt> is required to construct the Voronoi tessellation that is dual to its mesh, this is stored as a <tt>VertexMesh</tt>.
      The main difference is how the <tt>MeshBasedTissue</tt> then accesses information about the Voronoi tessellation.  Users should replace <tt>MeshBasedTissue</tt> calls to
      <tt>rGetVoronoiTessellation.GetFaceArea</tt> with <tt>GetAreaOfVoronoiElement</tt>, calls to <tt>rGetVoronoiTessellation.GetFacePerimeter</tt> with
      <tt>GetPerimeterOfVoronoiElement</tt>, and calls to <tt>rGetVoronoiTessellation.GetEdgeLength</tt> with <tt>GetVoronoiEdgeLength</tt>.
    </li>
    <li>Changed <tt>MeshBasedTissue</tt> method <tt>rGetVoronoiTessellation</tt> to <tt>GetVoronoiTessellation</tt> (i.e. return a pointer rather than a reference) in order to avoid memory issues.</li>
    <li>Various renamings have occurred:
      <ul>
      <li>
        <tt>MeshBasedTissue</tt> methods <tt>SetOutputTissueAreas</tt>, <tt>WriteTissueAreaResultsToFile</tt>, <tt>WriteCellAreaResultsToFile</tt> renamed to use
        <tt>Volume</tt> instead of <tt>Area</tt>.  Similarly merged the <tt>VertexMesh</tt> method <tt>GetPerimeterOfVoronoiElement</tt> into
        <tt>GetSurfaceAreaOfVoronoiElement</tt> and <tt>GetAreaOfVoronoiElement</tt> into <tt>GetVolumeOfVoronoiElement</tt>.
      </li>
      <li><tt>VertexMesh</tt> method <tt>SolveVoronoiElementIndexMapping</tt> renamed to <tt>GetVoronoiElementIndexCorrespondingToDelaunayNodeIndex</tt>.</li>
      </ul>
    </li>
    <li>When a <tt>MeshBasedTissue</tt> creates a Voronoi tessellation, this is constructed out of all nodes in the mesh, including ghost nodes.</li>
    <li><tt>CellwiseData</tt> has been generalised to cope with vertex-based tissues; some of its methods have changed names or arguments.</li>
  </ul>
  </li>
</ul>




<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<hr />
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->





<h2>Release 2.0 (changes since Release 1.1)</h2>

<h3>Headline features</h3>

<ul>
  <li>Dynamic loading of cell models defined in CellML (using a source release of Chaste).</li>
  <li>Checkpointing of cardiac simulations now supported.</li>
  <li>Support for open-source visualisation of cardiac simulations via VTK or cmgui.</li>
  <li>More cardiac simulation post-processing functionality now available in the executable.</li>
  <li>Support for transmural cellular heterogeneities definition in the XML parameters file.</li>
  <li>Support for more versions of our library dependencies.</li>
  <li>Improved documentation of the parameters file XML schema.</li>
  <li>Use of a distributed mesh in the cardiac executable.</li>
  <li>Use of parMETIS for partitioning in parallel cardiac simulations.</li>
  <li>Introduction of binary form of Triangle/Tetgen mesh format.</li>
  <li>Cancer component renamed to cell_based to reflect the increasing generality of the code.</li>
</ul>

<h3>Library compatibility</h3>
We have improved Chaste compatibility with its library dependencies:
<ul>
<li> MPI - Chaste is known to work with MPICH1 (mpich-1.2.7p1), MPICH2
(mpich2-1.1.1p1) and OpenMPI (1.2.7).  mpich-1.2.7p1 is recommended.  Note
that PETSc and HDF5 must be compiled with the same MPI that is used in the
Chaste configuration.</li>
<li> HDF5 - Chaste is known to work with version 1.6.6 (recommended) and
version 1.8.3.</li>
<li> PETSc - Chaste is known to work with version 2.2.1, version 2.3.2
(recommended), version 2.3.3 and version 3.0.</li>
<li> Boost - Chaste is regularly tested with Boost 1.33.1, Boost 1.34 (recommended), Boost 1.37 and Boost 1.40.
Chaste also supports Boost 1.36, 1.38 and 1.39, although these versions are not regularly tested.
Chaste DOES NOT WORK with Boost 1.35 (due to a known bug in that version of Boost)
 nor with version 1.41 and above (due to changes in the serialization library API).
</li>
</ul>

<h3>Code changes</h3>

<h4>New functionality</h4>

<ul>
  <li>
    To support ongoing extensions to the executable functionality, the Chaste parameters file now uses an XML
    namespace to indicate which version of Chaste it is for.
    This means that there are now multiple schemas in <tt>heart/src/io</tt>, one for release 1.1 and one for release 2.0.
    To update your parameters XML files, simply add a namespace declaration by adding the following attributes to the root
    <tt>ChasteParameters</tt> element:
    <pre>
       xmlns="https://chaste.cs.ox.ac.uk/nss/parameters/2_0"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="https://chaste.cs.ox.ac.uk/nss/parameters/2_0 ChasteParameters_2_0.xsd"</pre>
    See <tt>ChasteParameters.xml</tt> in the Chaste source folder for an example.  Make sure to use the correct path to the
    <tt>ChasteParameters_2_0.xsd</tt> file.
    Chaste should still be able to read old parameters files, but you will need to use the new version to take advantage of new features
    (such as post-processing and checkpointing).
  </li>
  
  <li>
    The cardiac executable has gained the ability to automatically load cell models encoded as CellML files at run-time, rather than needing
    them to be incorporated within Chaste when it is compiled.  In order to take advantage of this, you need (at present) to have built the
    executable from source yourself, as it uses your Chaste source tree to convert the CellML file into runnable code.
    
    <br />This change means that the definition of ionic models within the parameters file has changed.  To specify one of the models
    included within Chaste, you now need to wrap it in a <tt>&lt;Hardcoded&gt;</tt> element, e.g.
        <pre>    &lt;Hardcoded&gt;FaberRudy2000&lt;/Hardcoded&gt;</pre>
    Specify a dynamically loaded model using the <tt>&lt;Dynamic&gt;</tt> element instead, e.g.
        <pre>
    &lt;Dynamic&gt;
        &lt;Path relative_to="chaste_source_root"&gt;heart/dynamic/libDynamicallyLoadableLr91.so&lt;/Path&gt;
    &lt;/Dynamic&gt;</pre>
    The path may either point to a pre-compiled shared library (as in the example), or a CellML file.  If the latter, a shared library will
    be created in the same folder as the CellML file, and loaded by the executable at run-time.
    See <tt>heart/test/data/xml/ChasteParametersFullFormat.xml</tt> for a full example parameters file.
    
    <br />Another side effect of this
    is that the continuous test pack now requires the prerequisites for PyCml to be installed in order for the tests of this new functionality
    to pass.  See <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/InstallPyCml">InstallPyCml</a> for installation instructions.
  </li>
  
  <li>
    Checkpointing functionality has now been added to the cardiac executable.  This is activated by including a <tt>CheckpointSimulation</tt>
    element within the <tt>Simulation</tt> element, e.g.
    <pre>    &lt;CheckpointSimulation timestep="0.2" unit="ms" max_checkpoints_on_disk="3"/&gt;</pre>
    The <tt>timestep</tt> specifies how frequently to checkpoint, and must be a multiple of the printing timestep.  You can, optionally,
    specify the maximum number of checkpoints to keep on disk; when this limit is reached, the oldest checkpoint will be deleted before a new
    checkpoint is made.
    <br />Note that making a checkpoint does add a significant overhead at present, in particular because the mesh is written out to disk at
    each checkpoint.  This is to ensure that each checkpoint directory contains everything needed to resume the simulation.  In particular,
    the mesh written out will be in permuted form if it was partitioned for a parallel simulation.
    <br />Meshes written in checkpoints use a binary form of the Triangle/Tetgen mesh format.  This makes checkpoints significantly smaller but 
    will cause portability problems if checkpoints are moved between little-endian systems (e.g. x86) and big-endian systems (e.g. PowerPC).
    <br />Checkpoints will be written to a tree of folders adjacent to the main test output, as shown here (where &lt;OutputDirectory&gt; is
    the folder specified by the &lt;OutputDirectory&gt; element):
    <pre>
        CHASTE_TEST_OUTPUT
            &lt;OutputDirectory&gt;
            &lt;OutputDirectory&gt;_checkpoints
                0.2ms                        (or whatever the timestep is set to)
                    &lt;OutputDirectory&gt;        (a copy of the simulation output so far)
                    &lt;OutputDirectory&gt;_0.2ms  (the checkpoint data itself)
                    ResumeParameters.xml     (a parameters file for easy resuming from this checkpoint)
                0.4ms
                ...</pre>
    To resume from a checkpoint, copy the contents of the relevant folder (e.g. <tt>0.2ms</tt>) into the <tt>CHASTE_TEST_OUTPUT</tt> folder,
    edit the <tt>ResumeParameters.xml</tt> file to set the <tt>ArchiveDirectory</tt> correctly, and run the executable with that parameters
    file.
    <br />Checkpoints may be resumed on any number of processes &mdash; you are not restricted to the number on which it was saved.  However,
    the mesh will <b>not</b> be re-partitioned if loaded on a different number of processes, so the parallel efficiency of the simulation may
    be significantly reduced in this case.
    <br />Resuming a checkpoint will attempt to extend the original results h5 file, if present, so that the file contains the complete
    simulation results.  If this file does not exist, a new file will be created to contain just the results from the resume point.
  </li>
  
  <li>
    What format to convert HDF5 output to can now be specified in the XML configuration file (using the <tt>OutputVisualizer</tt> element),
    and hence via <tt>HeartConfig</tt>.  As part of this change, the default behaviour has also changed to outputting meshalyzer data;
    if you don't want this you have to explicitly turn it off.  There is an unfortunate conflict between visualizer output and outputting
    cell model state variables - you can't do both!  Calling <tt>SetOutputVariables</tt> on <tt>HeartConfig</tt> will automatically turn off
    visualizer output.  If you specify <tt>OutputVariables</tt> in the XML configuration file, however, you are responsible for also including
    an <tt>&lt;OutputVisualizer meshalyzer="no"/&gt;</tt> element.
  </li>
  
  <li>
    Some post-processing functionality may now be specified in the XML file, using the <tt>PostProcessing</tt> element within
    <tt>ChasteParameters</tt>.  Four post-processing outputs are possible, corresponding to 4 child elements:
    <ol>
      <li><tt>ActionPotentialDurationMap</tt></li>
      <li><tt>UpstrokeTimeMap</tt></li>
      <li><tt>MaxUpstrokeVelocityMap</tt></li>
      <li><tt>ConductionVelocityMap</tt></li>
    </ol>
    See the XML Schema documentation for more information on each of these.
  </li>

  <li>
    The cardiac executable has gained the ability to specify cellular transmural heterogeneities in 3D cardiac geometries as an alternative to the heterogeneity definition with cuboids (note that the two methods cannot be used simultaneously at the moment). To take advantage of this feature the user must provide three files defining left ventricular surface (LV), right ventricular surface (RV) and epicardial surface (EPI). These three files must have the same base name as the mesh in use and must contain a list of those node indices belonging to each surface. See <a href="File_Formats.html"> documentation on file formats </a> and the XML Schema documentation for more information.
    <br />
    Within the CellHeterogeneities element, the user has now the ability to specify three CellHeterogeneity elements, one for the epicardial layer, one for the midmyocardial layer and one for the endocardial layer. For each layer, it is possible to define the relative thickness of it (summation of the three relative thicknesses must be one) as well as a set of three scale factors for ionic conductances (Gks, Ito and Gkr). This feature is currently supported for the following cell models: tenTusscher2006, Maleckar2009 and FaberRudy2000. 
  </li>
  
  <li>
    Chaste can optionally use the CVODE library of ODE solvers for performing single cell cardiac simulations, and also more generally
    for solving ODEs.  This requires a change to your hostconfig file to specify the location of the CVODE libraries; see default.py for
    an example.  The <tt>CvodeAdaptor</tt> class presents the same interface as other Chaste ODE solvers, but uses CVODE.
    
    <br />There is also a specialised cardiac cell base class <tt>AbstractCvodeCell</tt> which uses CVODE's vector type natively for better
    performance.  Due to this it cannot be used in tissue simulations.  PyCml can generate subclasses of this class; use the --cvode option
    to the helper script (python/ConvertCellModel.py) in order to do so.
  </li>
  
  <li>
    Region attributes can be added to Triangle/Tetgen element and face/edge files.  
    These should be non-negative and can be retrieved with <tt>mesh.GetBoundaryElement(i)->GetRegion()</tt>
    or similar.  Note that (due to the default behaviour of Triangle) edges with a region attribute of zero 
    are ignored.
  </li>
  
  <li>
    The majority of the output files now include a comment detailing the
    version of Chaste that produced them.
  </li>
</ul>

<h4>Some behaviour corrections</h4>

<ul>
  <li>
    An indexing error in previous release meant that mesh produced by Chaste on the fly (slab/cuboid meshes) were not conforming.
    That is, the faces did not meet correctly and the finite element approximation was discontinuous.  This behaviour has been fixed.
  </li>
</ul>

<h4>Interface changes that may require changes to user code</h4>

<ul>
  <li>General:<ul>
    <li>
      <tt>LinearSystem::ZeroMatrixRow</tt> is deprecated due to inefficiency. 
      Use <tt>LinearSystem::ZeroMatrixRowsWithValueOnDiagonal</tt> to modify multiple rows instead.
    </li>
    <li>
      In the <tt>AssemblerTraits</tt> struct, the typenames '<tt>CVT_CLS</tt>', '<tt>CMT_CLS</tt>' and '<tt>INTERPOLATE_CLS</tt>'
      have been renamed to '<tt>CVT_CLASS</tt>', '<tt>CMT_CLASS</tt>' and '<tt>INTERPOLATE_CLASS</tt>'.
      These stand for 'ComputeVectorTerm class', 'ComputeMatrixTerm class' and 'Interpolate class' in case you are wondering,
      and the <tt>AssemblerTraits</tt> struct is used to state which classes these methods are implemented in. 
    </li>
    <li>
      Changed <tt>OdeSolution::WriteToFile()</tt> so that it no longer takes the <tt>AbstractOdeSystem</tt> as an argument.
    </li>
    <li>
      If you were implementing serialization for classes, note that the interface has changed, in order to better support different Boost
      versions.  You should include <tt>ChasteSerialization.hpp</tt> rather than <tt>boost/serialization/access.hpp</tt>.
      Also, the file <tt>TemplatedExport.hpp</tt>
      has been replaced with two files: <tt>SerializationExportWrapper.hpp</tt> and <tt>SerializationExportWrapperForCpp.hpp</tt>.
      You should include the first in .hpp files, after the class definition.  The second should be included in .cpp files, after any
      other includes (I suggest putting it at the end of the file for consistency).  In both cases, a suitable <tt>CHASTE_CLASS_EXPORT</tt>
      line should be used, the same in both .hpp and .cpp.  (There are also the usual variant macros for common cases of templated classes.)
      See <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/BoostSerialization">BoostSerialization</a> for more info. 
    </li>
    <li>
      The dependency on the METIS library has been replaced by one on parMETIS. This will require a small edit of the hostconfig file (see 
      INSTALLATION.txt for details).
    </li>
    <li>
      <tt>ParallelTetrahedralMesh</tt> has been renamed to
      <tt>DistributedTetrahedralMesh</tt>.
    </li>
    <li>
      The logic for project <tt>SConscript</tt> files has been moved into
      <tt>python/SConsTools.py</tt>.  This allows project
      <tt>SConscript</tt> files to be very short, and makes it easier to
      enhance or modify the build system logic in the future.  See the
      template project's <tt>SConscript</tt> file for an example; you will
      need to update your <tt>SConscript</tt> file, since the logic has
      changed since release 1.1.
    </li>
  </ul></li>
  
  <li>Cardiac:<ul>
    <li>
      The boundary conditions container in cardiac problem classes is now accessed via a <tt>boost::shared_ptr</tt> (rather than a raw pointer).
      The PDE assembler hierarchy is still using normal pointers, however, so this should only affect people creating cardiac problem subclasses,
      or setting their own boundary conditions for cardiac problems: if you do these, you'll need to use a shared pointer now.
    </li>
    <li>
      The methods <tt>ConvertOutputToMeshalyzerFormat</tt>, <tt>ConvertOutputToCmguiFormat</tt> and <tt>ConvertOutputToVtkFormat</tt>
      have been removed from <tt>AbstractCardiacProblem</tt>.  Code using these should change to use the methods
      <tt>SetVisualizeWithMeshalyzer</tt>, <tt>SetVisualizeWithCmgui</tt> or <tt>SetVisualizeWithVtk</tt> on <tt>HeartConfig</tt>.
    </li>
  </ul></li>
  
  <li>Cancer:<ul>
    <li>
      The <tt>cancer</tt> folder has been renamed to <tt>cell_based</tt> to reflect the more general nature of the code.
      There is a subfolder called <tt>crypt</tt> containing crypt-specific functionality.
      If you have a user project using the cancer code, a search &amp; replace from <tt>cancer</tt> to <tt>cell_based</tt> should suffice,
      especially in your project <tt>SConscript</tt> file.
    </li>
    <li>
      <tt>TissueConfig::Get/SetTopOfLinearWntGradient()</tt> have been renamed to <tt>Get/SetWntConcentrationParameter()</tt>,
      so that an exponential Wnt concentration could be added.
    </li>
    <li>
      The <tt>CryptCellMutationState</tt> enumeration has been replaced by a hierarchy of classes inheriting from
      <tt>AbstractCellMutationState</tt>.  <tt>TissueCell</tt>s now have a shared pointer to a mutation state.  To ensure proper counting
      of cells with each mutation, make sure that you give a cell a mutation state from its tissue's registry
      (<tt>AbstractTissue::GetMutationRegistry</tt>).  Also, when passing a vector of cells to a tissue constructor, the passed-in vector
      is now cleared, to emphasize that these cells become owned by the tissue.  Also removed <tt>AbstractTissue::mCellMutationStateCount</tt>
      and, as a result, changed <tt>rGetCellMutationStateCount()</tt> to <tt>GetCellMutationStateCount()</tt>.
    </li>
    <li>
      The <tt>CellsGenerator</tt> class hierarchy has been refactored to reduce code duplication.  There is now a base class
      <tt>CellsGenerator</tt>, which is templated over cell cycle model classes and dimension, and comprises <tt>GenerateBasic()</tt> and
      <tt>GenerateGivenLocationIndices()</tt> methods; and a subclass <tt>CryptCellsGenerator</tt>, which has an additional method
      <tt>Generate()</tt> that sets up cells for a crypt simulation.
    </li>
    <li>
      To reduce the number of calls to <tt>CreateCellPair</tt>, the <tt>MeshBasedTissue</tt> methods <tt>IsMarkedSpring</tt>,
      <tt>MarkSpring</tt> and <tt>UnmarkSpring</tt> no longer call the <tt>CreateCellPair</tt> method, and now take in a reference to a
      <tt>std::set&lt;TissueCell*&gt;</tt> instead of two <tt>TissueCell</tt> references.
    </li>
    <li>
      The <tt>mesh</tt> component now contains an extra folder <tt>vertex</tt>, which includes classes for the construction and
      reading/writing of 'vertex meshes' (these are meshes in which the number of nodes per element is unrestricted) as well as associated
      tests.
    </li>
    <li>
      <tt>AbstractCryptStatistics::GetWhetherCryptSectionCellsAreLabelled</tt> has been renamed to <tt>AreCryptSectionCellsLabelled</tt>.
    </li>
    <li>
      Changes to the archive format mean that checkpoint archives created with earlier versions of Chaste will not load in the new version.
    </li>
  </ul></li>
</li>
</ul>


<h2>Release 1.1 (changes since Release 1.0)</h2>

<h3>General</h3>

<ul>
<li>Parts of the <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/">Chaste developers wiki</a> have now been opened to the general public.  For a guest login, use the username &quot;anonymous&quot;, and your email address as the password.</li>
<li>Improved doxygen documentation.</li>
<li>PyCml is now included in the main Chaste trunk (<tt>python/pycml</tt>).  This means that you no longer need to download it separately.  Note that the PyCml distributed with release 1 will <em>not</em> generate code compatible with Chaste release 1.1 (see also below).</li>
</ul>

<h3>Code changes</h3>

<ul>
<li>Improved code portability.
  <ul>
  <li>(Some of) Chaste can now be run under Cygwin; see the <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/InstallGuides/Cygwin">InstallGuides/Cygwin</a> wiki page for details.</li>
  <li>Chaste now uses version 3.2.0 of <a href="http://www.codesynthesis.com/products/xsd/">XSD</a> (although versions 2.3.1 and 3.1.1a3 are also supported for now).  This should hopefully make Chaste easier to install on Macs</li>
  </ul></li>

<li>Some behaviour corrections.
  <ul>
  <li>For a dynamic assembler, if the matrix is constant you must now call <tt>this-&gt;SetMatrixIsConstant()</tt> in the constructor otherwise the matrix will now be assembled each timestep. If your matrix is not constant in time, you were getting wrong answers before!</li>
  <li>Bidomain problems with Neumann intracellular stimuli shouldn't have a solution, and there was an implementation error before which allowed them to be solved. This has been fixed, so any test with Neumann stimuli will not work. The stimulus has to be changed to a (standard) volume stimulus.</li>
  <li>For <tt>ELEMENT_DIM == 1</tt> (in any <tt>SPACE_DIM</tt>) <tt>MeshalyzerMeshWriter</tt> will now output a .cnnx file rather than a .tri file for element connections.</li>
  </ul></li>

<li>New functionality.
  <ul>
  <li><tt>MonodomainProblem</tt> is now templated on both <tt>ELEMENT_DIM</tt> and <tt>SPACE_DIM</tt>. It will default to using <tt>ELEMENT_DIM = SPACE_DIM</tt> if only one is supplied.</li>
  <li>Several helper macros have been written for debugging, see global/Debug.hpp.</li>
  <li>Added a <tt>CombinedOdeSystem</tt> class for simple coupling of ODE systems.</li>
  </ul></li>

<li>Work in progress.
  <ul>
  <li><em>Checkpointing</em> of cardiac simulations is on the way.  Most of the components of cardiac simulations now have their own archiving methods.  Unfortunately full checkpoint and restart functionality did not make it into this release.</li>
  <li>There is functionality in the code and the XML for <em>post-processing physiological quantities</em> such as action potential duration and activation maps.  This functionality may only be used at the developer level.  If you are running the executable then requests in the XML file for post-processing will be ignored. </li>
  </ul></li>

</ul>


<h4>Interface changes that may require changes to user code</h4>

<ul>

<li>General:<ul>
<li>Triangle and tetgen binaries are no longer included with the code and must be installed and set in the <tt>PATH</tt>.  Most re-meshing still works since 2D re-mesh compiles Triangle code from source (which is included).</li>
<li>The <a href="https://chaste.cs.ox.ac.uk/cgi-bin/trac.cgi/wiki/CodeStructureStrategy#Policyonincludes"><tt>#include</tt> policy</a> has changed. It might be the case that tests that used to compile are unable to find certain header files now. Please <tt>#include</tt> such headers explicitly as needed.</li>
<li>It is now impossible to create vectors (either PETSc <tt>Vec</tt>s or <tt>DistributedVector</tt>s) directly from a <tt>DistributedVector</tt>.  This must now be done via a <tt>DistributedVectorFactory</tt>.  If you have a mesh, a factory can be obtained using the <tt>GetDistributedVectorFactory</tt> method.  The cardiac PDEs also store a factory.</li>
<li>Static iterators are not available anymore in <tt>DistributedVector</tt>. You can access the iterator from a <tt>DistributedVector</tt> object. If there isn't one in scope, use <tt>GetLow()</tt> and <tt>GetHigh()</tt> in <tt>DistributedVectorFactory</tt> (accessible via any mesh object).</li>
<li>For a dynamic assembler, if the matrix is constant you must now call <tt>this-&gt;SetMatrixIsConstant()</tt> in the constructor otherwise the matrix will now be assembled each timestep. If your matrix is not constant in time, you were getting wrong answers before!</li>
<li>Renamed <tt>PetscTools::NumProcs</tt> to <tt>PetscTools::GetNumProcs</tt>.</li>
<li>Renamed <tt>AbstractMesh</tt> to <tt>AbstractTetrahedralMesh</tt>, there is a new <tt>AbstractMesh</tt> class, which will handle non-tetrahedral meshes.</li>
</ul></li>

<li>Heart:<ul>
<li><tt>this-&gt;mpMesh</tt> is no longer directly available to cell factories, as it can be used accidentally while unset. Use the <tt>GetMesh()</tt> method instead.</li>
<li>Cardiac cell models are now constructed using <tt>boost::shared_ptr&lt;&gt;</tt> instead of normal pointers for the 'stimulus' and 'ode solver' arguments.  This will require changes to cell factories too.  See files <tt>heart/test/ionicmodels/TestIonicModels.hpp</tt> and <tt>heart/src/problem/PlaneStimulusCellFactory.hpp</tt> for examples of the new usage.</li>
</ul></li>

<li>Cancer:<ul>
<li><tt>WntConcentration</tt> is now templated over dimension. You will have to pass in the dimension when constructing any Wnt-dependent cell cycle model.</li>
<li><tt>SloughingCellKiller</tt> is also now templated over dimension.</li>
<li><tt>FixedCellCycleModel</tt>, <tt>StochasticCellCycleModel</tt>, and the two corresponding <tt>CellGenerators</tt> have been renamed (to <tt>FixedDurationGenerationBasedCellCycleModel</tt> and <tt>StochasticDurationGenerationBasedCellCycleModel</tt> respectively).</li>
<li>The <tt>CancerParameters</tt> singleton class has been renamed <tt>TissueConfig</tt> (to match the heart code).</li>
<li><tt>cancer/src/tissue/MeshArchiveInfo</tt> has been replaced by <tt>global/src/ArchiveLocationInfo</tt>, which has slightly different usage.</li>
</ul></li>

</ul>

<p>
Also, xsd should be defined in your hostconfig file (if it isn't on your <tt>PATH</tt>) in the form <tt>tools = {'xsd':'FILL_IN_PATH_TO_XSD_BINARY'</tt>} as it regenerates <tt>ChasteParameters.hpp/cpp</tt> during the build process.
</p>


  </body>
</html>
